

CREATE OR REPLACE FUNCTION sp_init_test_data()
    RETURNS VOID AS $$
BEGIN
    -- Register new users
    INSERT INTO users (id, username, password, register_date, active)
    VALUES
        ('1', 'user1', 'p1', CURRENT_TIMESTAMP, TRUE),
        ('2', 'user2', 'p2', CURRENT_TIMESTAMP, TRUE),
        ('3', 'user3', 'p3', CURRENT_TIMESTAMP, TRUE),
        ('4', 'user4', 'p4', CURRENT_TIMESTAMP, TRUE);

    -- Create classes for characters
    -- dexterity - ловкость
    -- constitution - выносливость
    -- Description generated by AI
    INSERT INTO classes (id, name, description, default_constitution, default_dexterity, default_strength, default_health, default_intelligence)
    VALUES
        (1, 'Warrior', 'A strong melee fighter', 10, 5, 10, 100, 5),
        (2, 'Mage', 'A master of arcane arts', 5, 8, 4, 60, 12),
        (3, 'Rogue', 'A stealthy assassin', 6, 12, 7, 70, 8),
        (4, 'Paladin', 'A holy knight', 12, 6, 8, 80, 8),
        (5, 'Barbarian', 'A wild and furious warrior', 14, 4, 12, 90, 3),
        (6, 'Druid', 'A protector of nature', 7, 8, 5, 65, 12),
        (7, 'Bard', 'A charming musician and spellcaster', 6, 10, 5, 60, 11),
        (8, 'Alchemist', 'A master of potions and explosions', 6, 10, 5, 60, 11),
        (9, 'Warlock', 'A wielder of dark magic', 4, 6, 5, 55, 14);

    -- Create ClassModifiers
    --  'strength', 'dexterity', 'constitution', 'intelligence', 'health',  'armor', 'inventory', 'action_points'
    INSERT INTO class_modifiers (id, class_id, modifier_type, modifier_value)
    VALUES
        (1, 1, 'inventory', 0.95),
        (2, 4, 'action_points', 1.2),
        (3, 3, 'inventory', 1.2),
        (4, 3, 'action_points', 1.15);

    -- Initializing character_game_stats
    INSERT INTO character_game_stats (id, total_combats, total_losses, total_wins)
    VALUES
        (1, 0, 0, 0),
        (2, 0, 0, 0),
        (3, 0, 0, 0),
        (4, 0, 0, 0);

    -- Create characters, ap for example ...
    INSERT INTO characters (
        id, class_id, strength, dexterity, constitution, intelligence, health, action_points, character_game_stats_id
    )
    VALUES
        (1, 1, 10, 5, 10, 5, 100, 50, 1),
        (2, 2, 4, 8, 5, 12, 60, 80, 2),
        (3, 3, 7, 12, 6, 8, 70, 60, 3),
        (4, 4, 8, 6, 12, 8, 80, 40, 4);

    -- Assign characters to users
    INSERT INTO users_characters (user_id, character_id)
    VALUES
        ('1', '1'),
        ('2', '2'),
        ('3', '3'),
        ('4', '4');


    -- SleepCharacters
    INSERT INTO sleep_characters (character_id, max_health, wake_up_time, last_sleep_time)
    VALUES
        (1, 100, null, null),
        (2, 60, null, null),
        (3, 70, null, null),
        (4, 80, null, null);


    -- Create spells

    INSERT INTO spell_categories (id, name, description)
    VALUES
        (1, 'Fire Magic', 'Spells that ...'),
        (2, 'Ice Magic', 'Spells that ...'),
        (3, 'Lightning Magic', 'Spells that ...'),
        (4, 'Dark Magic', 'Spells that ...'),
        (5, 'Forbidden Magic', 'Rare and dangerous spells known only to the greatest mages.');


    INSERT INTO spells (id, spell_category_id, name, cost, rarity)
    VALUES
        (1, 1, 'Fireball', 10, 'common'),
        (2, 2, 'Ice Spike', 15, 'rare'),
        (3, 3, 'Lightning Bolt', 20, 'epic'),
        (4, 4, 'Dark Wave', 8, 'uncommon'),
        (999, 5, 'Soul Reaper', 25, 'legendary');

    INSERT INTO character_spells (id, character_id, spell_id)
    VALUES
        (1, 1, 1),-- 'Warrior'

        (2, 2, 1),-- 'Mage'
        (3, 2, 2),

        (4, 3, 4),-- 'Rogue'

        (5, 4, 4),-- 'Paladin'
        (6, 4, 3);


    INSERT INTO spell_configurations (id, spell_id, effect_type, effect_bonus_value, target_attribute)
    VALUES

        -- Base damages of spells
        (1, 1, 'base_damage', 20, 'strength'),
        (2, 2, 'base_damage', 25, 'intelligence'),
        (3, 3, 'base_damage', 30, 'strength'),
        (4, 4, 'base_damage', 15, 'strength'),
        (5, 999, 'base_damage', 50, 'strength'),

         -- attack bonus with damage based on target attribute of target character
         (6, 3, 'damage', 10, 'constitution'),

         (7, 999, 'damage', 10, 'intelligence'),
         (8, 999, 'damage', 15, 'dexterity'),
         (9, 999, 'damage', 25, 'health');

    -- Create items

    INSERT INTO item_types (id, name, description)
    VALUES
        (1, 'Weapon', 'A tool for combat'),
        (2, 'Armor', 'Protective gear'),
        (3, 'Accessory', 'Enhances abilities'),
        (4, 'Consumable', 'One-time use item');


    INSERT INTO items (id, name, weight, item_type_id, rarity)
    VALUES
        (1, 'Iron Sword', 5, 1, 'common'),
        (2, 'Steel Shield', 7, 2, 'rare'),
        (3, 'Leather Armor', 10, 3, 'uncommon'),
        (4, 'Magic Ring', 1, 4, 'epic'),

        (5, 'Magic Sword' , 5, 1, 'legendary'),

        (500, 'Ring Storage', 1, 4, 'epic');

    INSERT INTO inventories (id, character_id, item_id)
    VALUES
    --     (1, 1, 1),
    --     (2, 2, 2),
    --     (3, 3, 3),
        (1, 1, 4),
        (2, 2, 3);


    -- Slots available:
    -- 'head', 'chest', 'legs', 'weapon', 'shield', 'accessory'
    INSERT INTO character_equipments (character_id, item_id, slot_type)
    VALUES
        (1, 1, 'head'),
        (2, 2, 'shield'),
        (3, 5, 'weapon'),
        (4, 500, 'accessory');


    INSERT INTO equipment_categories (id, name, description)
    VALUES
        (1, 'Weapon', 'A tool for combat'),
        (2, 'Armor', 'Protective gear'),
        (3, 'Accessory', 'Enhances abilities');

    -- Insert equipments

    INSERT INTO equipments (id, item_id, equipment_category_id)
    VALUES
        (1, 1, 1),
        (2, 1, 2),
        (3, 500, 3);

    --         'strength', 'dexterity', 'constitution',
    --         'intelligence', 'health',
    --         'armor', 'inventory', 'action_points'
    INSERT INTO equipment_modifiers (equipment_id, modifier_type, modifier_value)
    VALUES
         (1, 'dexterity', 3),
         (2, 'armor', 4),
         (3, 'inventory', 3);


    -- Let's say we have a battle with 3 characters:
    INSERT INTO combats (id, date, rounds_count)
    VALUES
        (1, CURRENT_TIMESTAMP, 1); -- first round

    -- Game characters:
    INSERT INTO combat_players (combat_id, character_id, entry_health)
    VALUES
        (1, 2, 60), -- 'Mage'
        (1, 4, 80), -- 'Paladin'
        (1, 1, 100); -- 'Warrior'
END;
$$ LANGUAGE plpgsql;


CREATE OR REPLACE FUNCTION sp_reset_test_data()
    RETURNS VOID AS $$
BEGIN
    TRUNCATE TABLE
        users,
        classes,
        item_types,
        equipment_categories,
        spell_categories,
        spells,
        items,
        equipments,
        equipment_modifiers,
        character_game_stats,
        characters,
        combats,
        game_items,
        item_storages,
        sleep_characters,
        inventories,
        character_equipments,
        character_spells,
        combat_players,
        combat_logs,
        spell_configurations,
        class_modifiers,
        users_characters
    CASCADE;

    PERFORM sp_init_test_data();
END;
$$ LANGUAGE plpgsql;